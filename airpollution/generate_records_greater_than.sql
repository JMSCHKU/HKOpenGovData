select p.region, p.recorded, date(p.recorded) date, date_part('hour',p.recorded) as hour, no2, o3, so2, co, rsp, fsp from (select region, recorded, max(snapshot) snapshot, min(snapshot), count(*) from epd.airpollution where recorded >= '$1' group by region, recorded order by region, recorded) foo left join epd.airpollution p on foo.region = p.region and foo.recorded = p.recorded and foo.snapshot = p.snapshot order by date desc, hour desc, region
